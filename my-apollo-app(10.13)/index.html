<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fetching Repositories with Apollo Client</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/@apollo/client@3.9.7/dist/apollo-client.min.js"></script>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
      body {
        font-family: 'Inter', sans-serif;
      }
    </style>
</head>
<body class="bg-gray-100 p-8 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        // Access Apollo Client exports directly from the global window object.
        const { ApolloClient, InMemoryCache, ApolloProvider, gql, useQuery } = window;

        // The GraphQL query to fetch repositories.
        const REPOSITORIES_QUERY = gql`
          query Repositories {
            repositories {
              edges {
                node {
                  id
                  fullName
                  description
                  language
                  stargazersCount
                  forksCount
                  reviewCount
                }
              }
            }
          }
        `;

        // The custom hook that fetches repositories.
        const useRepositories = () => {
          const { data, loading, error } = useQuery(REPOSITORIES_QUERY, {
            fetchPolicy: 'cache-and-network',
          });

          if (loading || error || !data || !data.repositories || !data.repositories.edges) {
            return { repositories: [], loading, error };
          }

          const repositories = data.repositories.edges.map(edge => edge.node);
          return { repositories, loading, error };
        };

        // This component displays the list of repositories.
        const RepositoryList = () => {
          const { repositories, loading, error } = useRepositories();

          if (loading) {
            return (
              <div className="flex justify-center items-center h-full">
                <p className="text-xl text-gray-600">Loading...</p>
              </div>
            );
          }

          if (error) {
            return (
              <div className="flex justify-center items-center h-full">
                <p className="text-xl text-red-600">Error: {error.message}</p>
              </div>
            );
          }

          return (
            <div className="container mx-auto">
              <h1 className="text-4xl font-extrabold mb-8 text-center text-gray-900">Repositories</h1>
              <div className="grid gap-6 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3">
                {repositories.length > 0 ? (
                  repositories.map(repo => (
                    <div key={repo.id} className="bg-white p-6 rounded-xl shadow-lg border border-gray-200 transition-all duration-300 hover:shadow-2xl hover:border-blue-400">
                      <h2 className="text-2xl font-semibold text-blue-700 mb-2 truncate">{repo.fullName}</h2>
                      <p className="mt-2 text-gray-600 text-sm leading-relaxed">{repo.description}</p>
                      <div className="mt-4 flex flex-wrap gap-2 text-xs font-medium">
                        <span className="bg-blue-100 text-blue-800 px-3 py-1 rounded-full">{repo.language}</span>
                        <span className="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full flex items-center gap-1">
                          <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00.95-.69l1.07-3.292z" />
                          </svg>
                          {repo.stargazersCount}
                        </span>
                        <span className="bg-green-100 text-green-800 px-3 py-1 rounded-full">Forks: {repo.forksCount}</span>
                        <span className="bg-purple-100 text-purple-800 px-3 py-1 rounded-full">Reviews: {repo.reviewCount}</span>
                      </div>
                    </div>
                  ))
                ) : (
                  <p className="text-center text-gray-500 col-span-full">No repositories found.</p>
                )}
              </div>
            </div>
          );
        };

        // Set up the Apollo Client to connect to the GraphQL server.
        const client = new ApolloClient({
          uri: 'http://localhost:4000',
          cache: new InMemoryCache(),
        });

        // The main App component.
        const App = () => (
          <ApolloProvider client={client}>
            <RepositoryList />
          </ApolloProvider>
        );

        // Use the modern createRoot for React rendering.
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
